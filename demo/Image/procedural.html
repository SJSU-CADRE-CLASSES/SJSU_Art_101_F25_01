<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procedural Guinea Pig - Color Sampled Divs</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
        }

        .title {
            color: #333;
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
        }

        .controls {
            margin-bottom: 20px;
            text-align: center;
        }

        .controls button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .controls button:hover {
            background-color: #45a049;
        }

        .controls input[type="range"] {
            margin: 0 10px;
        }

        .controls label {
            font-weight: bold;
            margin-right: 5px;
        }

        .artwork-container {
            position: relative;
            width: 400px;
            height: 350px;
            border: 2px solid #ddd;
            background-color: white;
            overflow: hidden;
        }

        .pixel-div {
            position: absolute;
            border: none;
            /* Sharp corners - no border-radius */
        }

        .hidden-canvas {
            display: none;
        }

        .info {
            margin-top: 20px;
            color: #666;
            font-size: 14px;
            text-align: center;
            max-width: 500px;
        }

        .loading {
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="title">Procedural Guinea Pig - Color Sampled Divs</div>
    
    <div class="controls">
        <button onclick="generateArtwork()">Generate New Artwork</button>
        <button onclick="clearArtwork()">Clear</button>
        <br><br>
        <label for="density">Density:</label>
        <input type="range" id="density" min="50" max="500" value="200" onchange="updateDensity()">
        <span id="densityValue">200</span>
        <br><br>
        <label for="minSize">Min Size:</label>
        <input type="range" id="minSize" min="5" max="20" value="10" onchange="updateMinSize()">
        <span id="minSizeValue">10px</span>
        <br><br>
        <label for="maxSize">Max Size:</label>
        <input type="range" id="maxSize" min="20" max="50" value="40" onchange="updateMaxSize()">
        <span id="maxSizeValue">40px</span>
    </div>

    <div class="artwork-container" id="artworkContainer">
        <div class="loading">Loading guinea pig image...</div>
    </div>

    <div class="info">
        This artwork is generated by sampling colors from the guinea pig image and creating overlapping divs with sharp corners.<br>
        Each div is randomly sized between 10-40px and positioned to create a pixelated, downsampled effect.
    </div>

    <!-- Hidden canvas for image processing -->
    <canvas class="hidden-canvas" id="hiddenCanvas"></canvas>

    <script>
        let sourceImage = null;
        let canvas = null;
        let ctx = null;
        let isImageLoaded = false;

        // Configuration
        let config = {
            density: 200,
            minSize: 10,
            maxSize: 40
        };

        // Initialize when page loads
        window.onload = function() {
            canvas = document.getElementById('hiddenCanvas');
            ctx = canvas.getContext('2d');
            loadSourceImage();
        };

        function loadSourceImage() {
            // Create a guinea pig image using canvas (since we can't load external images)
            // We'll recreate the guinea pig using canvas drawing
            canvas.width = 400;
            canvas.height = 350;
            
            // Draw the guinea pig on canvas
            drawGuineaPigOnCanvas();
            
            isImageLoaded = true;
            document.querySelector('.loading').textContent = 'Image ready! Click "Generate New Artwork" to start.';
        }

        function drawGuineaPigOnCanvas() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw guinea pig body
            ctx.fillStyle = '#A0522D';
            ctx.beginPath();
            ctx.ellipse(200, 170, 110, 70, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw white band
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.ellipse(200, 170, 120, 25, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw black patch
            ctx.fillStyle = '#2F2F2F';
            ctx.beginPath();
            ctx.ellipse(150, 170, 40, 50, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw head
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.ellipse(200, 100, 70, 60, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw brown patches on head
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(230, 100, 35, 45, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.beginPath();
            ctx.ellipse(170, 100, 25, 30, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw ears
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(170, 70, 15, 22, -0.3, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.beginPath();
            ctx.ellipse(230, 70, 15, 22, 0.3, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw eyes
            ctx.fillStyle = '#000';
            ctx.beginPath();
            ctx.arc(185, 95, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(215, 95, 6, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw nose
            ctx.fillStyle = '#FFB6C1';
            ctx.beginPath();
            ctx.ellipse(200, 110, 4, 3, 0, 0, 2 * Math.PI);
            ctx.fill();
            
            // Draw feet
            ctx.fillStyle = '#FFB6C1';
            ctx.fillRect(180, 240, 15, 20);
            ctx.fillRect(205, 240, 15, 20);
            ctx.fillRect(160, 260, 15, 20);
            ctx.fillRect(225, 260, 15, 20);
        }

        function generateArtwork() {
            if (!isImageLoaded) {
                alert('Image not loaded yet. Please wait.');
                return;
            }

            clearArtwork();
            
            const container = document.getElementById('artworkContainer');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            // Define guinea pig areas where divs should be placed
            const guineaPigAreas = [
                // Body area
                { x: 90, y: 100, width: 220, height: 140, name: 'body' },
                // Head area
                { x: 130, y: 40, width: 140, height: 120, name: 'head' },
                // White band area
                { x: 80, y: 120, width: 240, height: 50, name: 'whiteBand' },
                // Black patch area
                { x: 60, y: 110, width: 80, height: 100, name: 'blackPatch' },
                // Ears
                { x: 155, y: 15, width: 30, height: 45, name: 'earLeft' },
                { x: 215, y: 15, width: 30, height: 45, name: 'earRight' },
                // Feet
                { x: 180, y: 240, width: 15, height: 20, name: 'foot1' },
                { x: 205, y: 240, width: 15, height: 20, name: 'foot2' },
                { x: 160, y: 260, width: 15, height: 20, name: 'foot3' },
                { x: 225, y: 260, width: 15, height: 20, name: 'foot4' }
            ];
            
            // Generate divs within guinea pig areas
            let divsGenerated = 0;
            const maxAttempts = config.density * 3; // Allow more attempts to find valid positions
            let attempts = 0;
            
            while (divsGenerated < config.density && attempts < maxAttempts) {
                attempts++;
                
                // Pick a random area
                const area = guineaPigAreas[Math.floor(Math.random() * guineaPigAreas.length)];
                
                // Generate position within that area
                const x = area.x + Math.random() * (area.width - config.maxSize);
                const y = area.y + Math.random() * (area.height - config.maxSize);
                const size = Math.random() * (config.maxSize - config.minSize) + config.minSize;
                
                // Make sure the div fits within the area
                if (x + size > area.x + area.width || y + size > area.y + area.height) {
                    continue;
                }
                
                // Sample color from the image at this position
                const color = sampleColorAtPosition(x, y, data, canvas.width);
                
                // Skip if color is too close to background (white/transparent)
                if (isBackgroundColor(color)) {
                    continue;
                }
                
                // Create div
                const div = document.createElement('div');
                div.className = 'pixel-div';
                div.style.left = x + 'px';
                div.style.top = y + 'px';
                div.style.width = size + 'px';
                div.style.height = size + 'px';
                div.style.backgroundColor = color;
                
                // Add some randomness to the color for variation
                const variation = Math.random() * 0.2 - 0.1; // -10% to +10%
                const variedColor = varyColor(color, variation);
                div.style.backgroundColor = variedColor;
                
                // Add slight transparency for overlapping effect
                div.style.opacity = 0.7 + Math.random() * 0.3;
                
                container.appendChild(div);
                divsGenerated++;
            }
        }

        function sampleColorAtPosition(x, y, data, width) {
            const pixelIndex = (Math.floor(y) * width + Math.floor(x)) * 4;
            const r = data[pixelIndex];
            const g = data[pixelIndex + 1];
            const b = data[pixelIndex + 2];
            const a = data[pixelIndex + 3];
            
            return `rgb(${r}, ${g}, ${b})`;
        }

        function isBackgroundColor(color) {
            // Check if color is close to white background
            const match = color.match(/rgb\((\d+), (\d+), (\d+)\)/);
            if (match) {
                const r = parseInt(match[1]);
                const g = parseInt(match[2]);
                const b = parseInt(match[3]);
                
                // Consider it background if it's very close to white
                return (r > 250 && g > 250 && b > 250);
            }
            return false;
        }

        function varyColor(color, variation) {
            // Convert rgb string to values
            const match = color.match(/rgb\((\d+), (\d+), (\d+)\)/);
            if (match) {
                let r = parseInt(match[1]);
                let g = parseInt(match[2]);
                let b = parseInt(match[3]);
                
                r = Math.max(0, Math.min(255, r + (r * variation)));
                g = Math.max(0, Math.min(255, g + (g * variation)));
                b = Math.max(0, Math.min(255, b + (b * variation)));
                
                return `rgb(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)})`;
            }
            return color;
        }

        function clearArtwork() {
            const container = document.getElementById('artworkContainer');
            const divs = container.querySelectorAll('.pixel-div');
            divs.forEach(div => div.remove());
        }

        function updateDensity() {
            config.density = document.getElementById('density').value;
            document.getElementById('densityValue').textContent = config.density;
        }

        function updateMinSize() {
            config.minSize = parseInt(document.getElementById('minSize').value);
            document.getElementById('minSizeValue').textContent = config.minSize + 'px';
        }

        function updateMaxSize() {
            config.maxSize = parseInt(document.getElementById('maxSize').value);
            document.getElementById('maxSizeValue').textContent = config.maxSize + 'px';
        }
    </script>
</body>
</html>
